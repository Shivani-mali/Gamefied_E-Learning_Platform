<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parent Dashboard | Learning Fun</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        min-height: 100vh;
        color: #e2e8f0;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: linear-gradient(
          135deg,
          #0f1419 0%,
          #1a2332 70%,
          #02060aff 100%
        );
        border-radius: 20px;
        padding: 40px;
        margin-bottom: 40px;
        box-shadow: 0 15px 35px rgba(0, 102, 204, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
      }

      .header h1 {
        font-size: 3em;
        font-weight: 800;
        margin: 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .child-info {
        text-align: right;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 10px;
      }

      .child-name {
        font-size: 1.5em;
        color: #a0dfffff;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .logout-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 600;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        align-self: flex-end;
        min-width: 100px;
      }

      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }

      .quick-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(0, 102, 204, 0.2);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .quick-stat-item {
        text-align: center;
        position: relative;
        padding: 20px;
        border-radius: 15px;
        background: linear-gradient(
          135deg,
          rgba(0, 102, 204, 0.1),
          rgba(0, 153, 255, 0.05)
        );
        border: 1px solid rgba(0, 102, 204, 0.3);
        transition: all 0.3s ease;
        animation: fadeInScale 0.8s ease-out forwards;
        opacity: 0;
        transform: scale(0.8);
      }

      .quick-stat-item:nth-child(1) {
        animation-delay: 0.1s;
      }
      .quick-stat-item:nth-child(2) {
        animation-delay: 0.2s;
      }
      .quick-stat-item:nth-child(3) {
        animation-delay: 0.3s;
      }
      .quick-stat-item:nth-child(4) {
        animation-delay: 0.4s;
      }

      .quick-stat-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 25px rgba(0, 0, 0, 0.1);
      }

      .quick-stat-number {
        font-size: 2.5em;
        font-weight: 800;
        color: #00bfff;
        margin-bottom: 5px;
        text-shadow: 0 2px 4px rgba(0, 191, 255, 0.3);
      }

      .quick-stat-label {
        font-size: 0.9em;
        color: #b8c5d1;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .quick-stat-icon {
        font-size: 1.5em;
        margin-bottom: 10px;
        display: block;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 25px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        transition: all 0.4s ease;
        border: 1px solid rgba(0, 102, 204, 0.2);
        backdrop-filter: blur(20px);
        position: relative;
        overflow: hidden;
        animation: fadeInUp 0.6s ease-out forwards;
        opacity: 0;
        transform: translateY(20px);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, #0066cc, #0099ff, #00ccff);
      }

      .stat-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
      }

      .stat-card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .stat-card:nth-child(2) {
        animation-delay: 0.2s;
      }
      .stat-card:nth-child(3) {
        animation-delay: 0.3s;
      }
      .stat-card:nth-child(4) {
        animation-delay: 0.4s;
      }
      .stat-card:nth-child(5) {
        animation-delay: 0.5s;
      }
      .stat-card:nth-child(6) {
        animation-delay: 0.6s;
      }

      .stat-card h3 {
        color: #ffffff;
        font-size: 1.5em;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .stat-card h3::before {
        content: "üìä";
        margin-right: 10px;
        font-size: 1.2em;
      }

      .time-spent h3::before {
        content: "‚è±Ô∏è";
      }

      .completed-works h3::before {
        content: "‚úÖ";
      }

      .progress-section h3::before {
        content: "üìà";
      }

      .achievements h3::before {
        content: "üèÜ";
      }

      .activity h3::before {
        content: "üìÖ";
      }

      .time-display {
        font-size: 2.5em;
        font-weight: bold;
        color: #00bfff;
        text-align: center;
        margin: 15px 0;
        text-shadow: 0 2px 4px rgba(0, 191, 255, 0.3);
      }

      .time-unit {
        font-size: 0.5em;
        color: #94a3b8;
        display: block;
        margin-top: 5px;
      }

      .works-list {
        list-style: none;
        padding: 0;
        max-height: 200px;
        overflow-y: auto;
      }

      .works-list li {
        background: rgba(255, 255, 255, 0.05);
        margin: 8px 0;
        padding: 12px 15px;
        border-radius: 8px;
        border-left: 4px solid #00bfff;
        font-weight: 500;
        transition: background 0.2s ease;
        color: #e2e8f0;
      }

      .works-list li:hover {
        background: rgba(0, 191, 255, 0.1);
      }

      .achievements-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .achievement-badge {
        background: linear-gradient(45deg, #00bfff, #0099ff);
        color: #ffffff;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0, 191, 255, 0.3);
      }

      .last-activity {
        text-align: center;
        font-size: 1.2em;
        color: #e2e8f0;
        font-weight: 600;
        margin: 20px 0;
      }

      .progress-item {
        margin-bottom: 20px;
      }

      .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-weight: 600;
        color: #e2e8f0;
      }

      .progress-bar {
        width: 100%;
        height: 14px;
        background: #e2e8f0;
        border-radius: 7px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00bfff, #0099ff);
        width: 0;
        transition: width 1.5s ease;
        border-radius: 7px;
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInScale {
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .grade-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .grade-badge {
        background: linear-gradient(45deg, #ff6b6b, #ff4757);
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
        min-width: 30px;
        text-align: center;
      }

      .feedback-section h3::before {
        content: "üí¨";
      }

      .feedback-list {
        max-height: 150px;
        overflow-y: auto;
        margin-bottom: 15px;
      }

      .feedback-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 10px;
        border-radius: 8px;
        margin: 5px 0;
        font-size: 0.9em;
        color: #e2e8f0;
      }

      .feedback-form textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid rgba(0, 191, 255, 0.3);
        border-radius: 8px;
        resize: vertical;
        min-height: 80px;
        font-family: inherit;
        margin-bottom: 10px;
        background: rgba(255, 255, 255, 0.05);
        color: #e2e8f0;
      }

      .feedback-form textarea:focus {
        border-color: #00bfff;
        outline: none;
      }

      .submit-btn {
        background: linear-gradient(45deg, #00bfff, #0099ff);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 191, 255, 0.4);
      }

      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
        }

        .child-info {
          text-align: center;
          margin-top: 20px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .quick-stats {
          grid-template-columns: repeat(2, 1fr);
          gap: 15px;
          padding: 20px;
        }

        .quick-stat-number {
          font-size: 2em;
        }
      }

      .footer {
        text-align: center;
        padding: 20px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.9em;
        margin-top: 40px;
        border-top: 1px solid rgba(0, 102, 204, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Student Work Dashboard</h1>
        <div class="child-info">
          <div class="child-name">Monitoring: {{ child_name or child_email }}</div>
          <button
            class="logout-btn"
            onclick="window.location.href='/parent_logout'"
          >
            Logout
          </button>
        </div>
      </div>

      <div class="quick-stats">
        <div class="quick-stat-item">
          <span class="quick-stat-icon">üìö</span>
          <div class="quick-stat-number">{{ completed_works|length }}</div>
          <div class="quick-stat-label">Activities Done</div>
        </div>
        <div class="quick-stat-item">
          <span class="quick-stat-icon">‚≠ê</span>
          <div class="quick-stat-number">{{ achievements|length }}</div>
          <div class="quick-stat-label">Achievements</div>
        </div>
        <div class="quick-stat-item">
          <span class="quick-stat-icon">üìà</span>
          <div class="quick-stat-number">
            {% set p = progress or {} %}
            {% set count = p|length %}
            {% if count > 0 %}
              {% set total = 0 %}
              {% for pct in p.values() %}{% set total = total + (pct or 0) %}{% endfor %}
              {{ "%.1f"|format(total / count) }}%
            {% else %}
              0.0%
            {% endif %}
          </div>
          <div class="quick-stat-label">Avg Progress</div>
        </div>
        <div class="quick-stat-item">
          <span class="quick-stat-icon">‚è∞</span>
          <div class="quick-stat-number">{{ (time_spent / 60)|round|int }}</div>
          <div class="quick-stat-label">Hours This Week</div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card time-spent">
          <h3>Time Spent Learning</h3>
          <div class="time-display">
            {{ time_spent }}<span class="time-unit">minutes</span>
          </div>
          <p style="text-align: center; color: #718096">
            Total learning time this week
          </p>
        </div>

        <div class="stat-card activity">
          <h3>Last Activity</h3>
          <div class="last-activity">{{ last_activity }}</div>
          <p style="text-align: center; color: #718096">
            Most recent learning session
          </p>
        </div>

        <div class="stat-card achievements">
          <h3>Achievements</h3>
          <div class="achievements-list">
            {% for achievement in achievements %}
            <div class="achievement-badge">{{ achievement }}</div>
            {% else %}
            <p style="color: #a0aec0; text-align: center">
              No achievements yet
            </p>
            {% endfor %}
          </div>
        </div>

        <div class="stat-card completed-works">
          <h3>Primary Completed Activities</h3>
          <ul class="works-list">
            {% for work in completed_works %}
            {% if not work.startswith('Pre-Primary') %}
            <li>{{ work }}</li>
            {% endif %}
            {% else %}
            <li style="color: #a0aec0">No activities completed yet</li>
            {% endfor %}
          </ul>
        </div>

        <div class="stat-card progress-section">
          <h3>Primary Subject Progress & Grades</h3>
          {% for area, pct in (progress or {}).items() %}
          <div class="progress-item">
            <div class="progress-label">
              <span>{{ area }}</span>
              <div class="grade-info">
                <span class="percentage">{{ pct }}%</span>
                <span class="grade-badge">{{ grades[area] }}</span>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" data-width="{{ pct }}"></div>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="stat-card">
          <h3>Pre-Primary Progress</h3>
          {% set sections = ['colors','animals','fruits','vegetables','numbers','strokes'] %}
          {% for sec in sections %}
          {% set s = (preprimary_progress or {}).get(sec, {}) %}
          <div class="progress-item">
            <div class="progress-label">
              <span style="text-transform: capitalize;">{{ sec }}</span>
              <span style="font-weight:600; color:#a0dfff;">
                {{ '‚úÖ Watched' if s.get('video_watched') else '‚ùå Not watched' }}
              </span>
            </div>
            <div style="display:flex; gap:16px; color:#cbd5e1; font-weight:600; margin-bottom:8px;">
              <span>Games: {{ s.get('games_played', 0) }}</span>
              <span>Quiz: {{ s.get('quiz_score', 0) }}/4</span>
            </div>
            <div style="font-size:12px; color:#94a3b8;">Updated: {{ s.get('last_updated', '‚Äî') }}</div>
          </div>
          {% endfor %}
        </div>
        <div class="stat-card feedback-section">
          <h3>Parent Feedback</h3>
          <div class="feedback-list">
            {% for fb in feedback %}
            <div class="feedback-item">
              <strong>{{ fb.date }}:</strong> {{ fb.message }}
            </div>
            {% else %}
            <p style="color: #a0aec0; text-align: center">No feedback yet</p>
            {% endfor %}
          </div>
          <form method="post" action="/submit_feedback" class="feedback-form">
            <textarea
              name="feedback"
              placeholder="Leave feedback for your child..."
              required
            ></textarea>
            <button type="submit" class="submit-btn">Submit Feedback</button>
          </form>
        </div>
      </div>

      <div class="footer">
        ¬© 2025 Learning Fun | Student Work Monitoring Portal
      </div>
    </div>

    <script>
      // Animate progress bars and elements on load
      document.addEventListener("DOMContentLoaded", function () {
        // Animate progress bars with stagger ‚Äî use data-width to avoid percent sign in template
        const fills = document.querySelectorAll(".progress-fill");
        fills.forEach((fill, index) => {
          const pct = fill.getAttribute("data-width") || "0";
          const width = pct + "%";
          fill.style.width = "0";
          setTimeout(() => {
            fill.style.width = width;
          }, index * 300);
        });

        // Add entrance animation to cards
        const cards = document.querySelectorAll(".stat-card");
        cards.forEach((card, index) => {
          card.style.opacity = "0";
          card.style.transform = "translateY(20px)";
          setTimeout(() => {
            card.style.transition = "all 0.6s ease";
            card.style.opacity = "1";
            card.style.transform = "translateY(0)";
          }, index * 100);
        });

        // Animate achievement badges
        const badges = document.querySelectorAll(".achievement-badge");
        badges.forEach((badge, index) => {
          badge.style.opacity = "0";
          badge.style.transform = "scale(0.8)";
          setTimeout(() => {
            badge.style.transition = "all 0.4s ease";
            badge.style.opacity = "1";
            badge.style.transform = "scale(1)";
          }, 1000 + index * 200);
        });
      });
    </script>
  </body>
</html>
