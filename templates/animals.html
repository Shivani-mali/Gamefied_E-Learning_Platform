<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Animal Fun ‚Äì Watch & Play</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            text-align: center;
            margin: 0;
            padding: 40px;
            position: relative;
            min-height: 100vh;
        }

        #bg-video {
            position: fixed;
            top: 0;
            left: 0;
            min-width: 100vw;
            min-height: 100vh;
            width: auto;
            height: auto;
            z-index: -1;
            object-fit: cover;
            opacity: 0.6;
            pointer-events: none;
        }

        h2 { color: #ff4081; text-shadow: 2px 2px #fff; }
        iframe, #player { width: 100vw; height: 100vh; border: none; }

        .question { margin: 20px auto; padding: 15px; width: 60%; background: rgba(255,255,255,0.9); border-radius: 15px; box-shadow: 0 0 10px rgba(0,0,0,0.2); text-align: left; }
        .question-container { display: none; opacity: 0; transform-origin: center; transform: scale(0.8) rotateY(90deg); transition: all 1.2s ease-in-out; }
        .question-container.show { display: block; opacity: 1; transform: scale(1) rotateY(0deg); animation: openBook 1.2s ease-in-out forwards; }
        @keyframes openBook { 0%{transform:rotateY(90deg) scale(0.8); opacity:0;} 50%{transform:rotateY(45deg) scale(0.9); opacity:0.7;} 100%{transform:rotateY(0deg) scale(1); opacity:1;} }

        .submit-container { display:flex; justify-content:center; margin:40px 0; bottom:20px; position:relative; }
        button { background:#ff4081; color:#fff; font-size:18px; padding:10px 25px; border:none; border-radius:25px; cursor:pointer; transition:0.3s; }
        button:hover { background:#e91e63; }

        .badge { display:none; margin-top:30px; animation: pop 1s ease; }
        .badge img { width:150px; animation: bounce 1.5s infinite; }
        @keyframes pop { 0%{transform:scale(0.5); opacity:0;} 100%{transform:scale(1); opacity:1;} }
        @keyframes bounce { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-15px);} }

        .game-card { margin:30px auto; padding:25px; width:80%; max-width:600px; background: rgba(255,255,255,0.95); border-radius:20px; box-shadow:0 0 15px rgba(0,0,0,0.3); }
        .game-card h3 { color:#ff4081; margin-bottom:15px; font-size:28px; }

        .animal-display { text-align:center; margin:20px 0; }
        .sound-options { display:flex; justify-content:center; gap:15px; flex-wrap:wrap; margin-top:20px; }
        .sound-btn { background:linear-gradient(45deg,#4CAF50,#8BC34A); color:#fff; font-size:22px; font-weight:bold; padding:20px 30px; border:none; border-radius:20px; cursor:pointer; transition:all 0.3s; box-shadow:0 6px 12px rgba(0,0,0,0.3); }
        .sound-btn:hover { transform:scale(1.1); box-shadow:0 8px 16px rgba(0,0,0,0.4); }

        .feed-game { display:flex; justify-content:center; gap:25px; flex-wrap:wrap; margin:30px 0; }
        .animal-feed { width:120px; height:140px; background:#fff; border:4px solid #333; border-radius:20px; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; transition:all 0.3s; box-shadow:0 5px 15px rgba(0,0,0,0.2); padding:8px 6px; }
        .animal-feed .emoji { font-size:54px; line-height:1; }
        .animal-feed .label { font-size:18px; font-weight:bold; color:#333; margin-top:6px; }
        .animal-feed:hover { transform:scale(1.15) translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,0.3); }
        .animal-feed.fed { animation: happy 0.6s ease; background: linear-gradient(45deg,#FFD700,#FFA500); }
        @keyframes happy { 0%,100%{transform:scale(1) rotate(0deg);} 25%{transform:scale(1.2) rotate(-10deg);} 75%{transform:scale(1.2) rotate(10deg);} }
        @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-10px);} 75%{transform:translateX(10px);} }
    </style>
</head>
<body>
  <video autoplay muted loop id="bg-video">
    <source src="{{ url_for('static', filename='video/kids_play.mp4') }}" type="video/mp4">
  </video>

  <h2>üé• Watch & Learn!</h2>
  <div id="player"></div>

  <div id="games" class="question-container">
    <h2>üéÆ Let's Play Animal Games!</h2>

    <div class="game-card">
      <h3>üîä Animal Sound Game!</h3>
      <div class="animal-display">
        <div id="animalEmoji" style="font-size:120px; margin:20px;">ü¶Å</div>
        <p id="animalQuestion" style="font-size:24px; font-weight:bold; color:#333;">What sound does this animal make?</p>
      </div>
      <div class="sound-options">
        <button class="sound-btn" onclick="checkSound('roar', this)">ü¶Å ROAR!</button>
        <button class="sound-btn" onclick="checkSound('bark', this)">üêï WOOF!</button>
        <button class="sound-btn" onclick="checkSound('meow', this)">üê± MEOW!</button>
        <button class="sound-btn" onclick="checkSound('moo', this)">üêÑ MOO!</button>
      </div>
      <p id="soundResult" style="font-size: 28px; font-weight: bold; margin-top: 20px;"></p>
      <p id="animalScore" style="font-size: 26px; color: green; font-weight: bold;">Score: 0 ‚≠ê</p>
    </div>

    <div class="game-card">
      <h3>üçé Feed the Animals!</h3>
      <p style="font-size:20px;">Click on the animals to feed them! ü•ï</p>
      <div class="feed-game">
        <div class="animal-feed" onclick="feedAnimal(this)"><div class="emoji">üê∞</div><div class="label">Rabbit</div></div>
        <div class="animal-feed" onclick="feedAnimal(this)"><div class="emoji">üêº</div><div class="label">Panda</div></div>
        <div class="animal-feed" onclick="feedAnimal(this)"><div class="emoji">üêµ</div><div class="label">Monkey</div></div>
        <div class="animal-feed" onclick="feedAnimal(this)"><div class="emoji">üê®</div><div class="label">Koala</div></div>
      </div>
      <p id="feedMsg" style="font-size:24px; color:blue; font-weight:bold; margin-top:20px;">Click animals to feed them! üòä</p>
    </div>

    <div class="game-card">
      <h3>üß© Find the Animal!</h3>
      <p id="findAnimalInstruction" style="font-size:22px; font-weight:bold;">Tap the LION! ü¶Å</p>
      <div style="display:flex; justify-content:center; gap:18px; margin:20px 0; flex-wrap:wrap;">
        <div class="animal-feed" onclick="chooseAnimal('Lion', this)"><div class="emoji">ü¶Å</div><div class="label">Lion</div></div>
        <div class="animal-feed" onclick="chooseAnimal('Dog', this)"><div class="emoji">üêï</div><div class="label">Dog</div></div>
        <div class="animal-feed" onclick="chooseAnimal('Cat', this)"><div class="emoji">üê±</div><div class="label">Cat</div></div>
      </div>
      <p id="findAnimalMsg" style="font-size: 22px; color: purple; font-weight: bold;"></p>
    </div>

    <button onclick="showQuiz()" style="margin-top: 30px; font-size: 20px; padding: 15px 40px;">Continue to Quiz üìù</button>
  </div>

  <div id="questions" class="question-container">
    <h2>‚ùì Answer these fun questions about Animals</h2>

    <div class="question">
      <p>1. Which animal is known as the 'King of the Jungle'?</p>
      <p> ‡§ï‡§ø‡§∏ ‡§ú‡§æ‡§®‡§µ‡§∞ ‡§ï‡•ã '‡§ú‡§Ç‡§ó‡§≤ ‡§ï‡§æ ‡§∞‡§æ‡§ú‡§æ' ‡§ï‡§π‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à?</p>
      <input type="radio" name="q1" value="Lion"> Lion (‡§∂‡•á‡§∞) <br>
      <input type="radio" name="q1" value="Tiger"> Tiger (‡§¨‡§æ‡§ò) <br>
      <input type="radio" name="q1" value="Elephant"> Elephant (‡§π‡§æ‡§•‡•Ä) <br>
    </div>

    <div class="question">
      <p>2. Which animal has a long neck?</p>
      <p> ‡§ï‡§ø‡§∏ ‡§ú‡§æ‡§®‡§µ‡§∞ ‡§ï‡•Ä ‡§ó‡§∞‡•ç‡§¶‡§® ‡§¨‡§π‡•Å‡§§ ‡§≤‡§Ç‡§¨‡•Ä ‡§π‡•ã‡§§‡•Ä ‡§π‡•à?</p>
      <input type="radio" name="q2" value="Giraffe"> Giraffe (‡§ú‡§ø‡§∞‡§æ‡§´) <br>
      <input type="radio" name="q2" value="Lion"> Lion (‡§∂‡•á‡§∞) <br>
      <input type="radio" name="q2" value="Monkey"> Monkey (‡§¨‡§Ç‡§¶‡§∞) <br>
    </div>

    <div class="question">
      <p>3. Which animal can fly?</p>
      <p> ‡§ï‡•å‡§® ‡§∏‡§æ ‡§ú‡§æ‡§®‡§µ‡§∞ ‡§â‡§°‡§º ‡§∏‡§ï‡§§‡§æ ‡§π‡•à?</p>
      <input type="radio" name="q3" value="Bird"> Bird (‡§™‡§ï‡•ç‡§∑‡•Ä) <br>
      <input type="radio" name="q3" value="Fish"> Fish (‡§Æ‡§õ‡§≤‡•Ä) <br>
      <input type="radio" name="q3" value="Dog"> Dog (‡§ï‡•Å‡§§‡•ç‡§§‡§æ) <br>
    </div>

    <div class="question">
      <p>4. Which animal lives in water?</p>
      <p> ‡§ï‡•å‡§® ‡§∏‡§æ ‡§ú‡§æ‡§®‡§µ‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§Æ‡•á‡§Ç ‡§∞‡§π‡§§‡§æ ‡§π‡•à?</p>
      <input type="radio" name="q4" value="Fish"> Fish (‡§Æ‡§õ‡§≤‡•Ä) <br>
      <input type="radio" name="q4" value="Cat"> Cat (‡§¨‡§ø‡§≤‡•ç‡§≤‡•Ä) <br>
      <input type="radio" name="q4" value="Cow"> Cow (‡§ó‡§æ‡§Ø) <br>
    </div>

    <div class="submit-container">
      <button onclick="checkAnswers()">Submit ‚úÖ</button>
    </div>

    <div class="badge" id="badge">
      <h3 id="badge-text"><span style="position:absolute;left:-9999px;">Badge result will appear here</span></h3>
      <img id="badge-img"
           data-badge="{{ url_for('static', filename='images/badge.png') }}"
           data-oops="{{ url_for('static', filename='images/oops.png') }}"
           src="{{ url_for('static', filename='images/badge.png') }}"
           alt="Badge">
    </div>
  </div>

  <audio id="correct-sound" src="{{ url_for('static', filename='audio/yaayyy.mp3') }}" preload="auto"></audio>
  <audio id="wrong-sound" src="{{ url_for('static', filename='audio/ohhno.mp3') }}" preload="auto"></audio>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;

    // Progress helper for Pre-Primary (Animals)
    function sendProgress(payload){
      try {
        fetch('/preprimary/progress/update', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(Object.assign({ section: 'animals' }, payload))
        });
      } catch(e) { /* ignore */ }
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: 'bBVKIUc1tfY',
        playerVars: { 'autoplay': 1, 'controls': 1, 'modestbranding': 1, 'fs': 1 },
        events: { 'onStateChange': onPlayerStateChange }
      });
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        document.getElementById('player').style.display = 'none';
        document.getElementById('games').classList.add('show');
        startSoundGame();
        startFindAnimalGame();
        sendProgress({ video_watched: true });
      }
    }

    function showQuiz() {
      document.getElementById('games').style.display = 'none';
      document.getElementById('questions').classList.add('show');
    }

    // Animal Sound Game
    const animalSounds = [
      {emoji:'ü¶Å', name:'Lion', sound:'roar'},
      {emoji:'üêï', name:'Dog', sound:'bark'},
      {emoji:'üê±', name:'Cat', sound:'meow'},
      {emoji:'üêÑ', name:'Cow', sound:'moo'}
    ];
    let currentAnimal;
    let soundScore = 0;
    let correctSound = new Audio("{{ url_for('static', filename='audio/yaayyy.mp3') }}");
    let wrongSound = new Audio("{{ url_for('static', filename='audio/ohhno.mp3') }}");

    function startSoundGame(){ pickNewAnimal(); }
    function pickNewAnimal(){
      currentAnimal = animalSounds[Math.floor(Math.random()*animalSounds.length)];
      document.getElementById('animalEmoji').textContent = currentAnimal.emoji;
      document.getElementById('animalQuestion').textContent = `What sound does the ${currentAnimal.name} make?`;
      document.getElementById('soundResult').textContent = '';
    }
    function checkSound(sound, btn){
      const result = document.getElementById('soundResult');
      if (sound === currentAnimal.sound){
        result.textContent = 'üéâ YES! Correct!';
        result.style.color = 'green';
        soundScore++;
        document.getElementById('animalScore').textContent = `Score: ${soundScore} ‚≠ê`;
        correctSound.play();
        sendProgress({ inc_games: 1 });
        setTimeout(pickNewAnimal, 1200);
      } else {
        result.textContent = '‚ùå Try again!';
        result.style.color = 'red';
        wrongSound.play();
        btn.style.animation = 'shake 0.5s';
        setTimeout(()=>{ btn.style.animation=''; },500);
      }
    }

    // Feed the Animals Game
    function feedAnimal(el){
      if (!el.classList.contains('fed')){
        el.classList.add('fed');
        document.getElementById('feedMsg').textContent = 'üòã Yummy! The animal is happy! Feed more!';
        document.getElementById('feedMsg').style.color = 'green';
        correctSound.play();
        sendProgress({ inc_games: 1 });
        setTimeout(()=>{ el.classList.remove('fed'); },600);
      }
    }

    // Find the Animal Game
    const findAnimals = [ {name:'Lion', emoji:'ü¶Å'}, {name:'Dog', emoji:'üêï'}, {name:'Cat', emoji:'üê±'} ];
    let targetAnimal = null;
    function startFindAnimalGame(){ pickNewFindAnimal(); }
    function pickNewFindAnimal(){
      targetAnimal = findAnimals[Math.floor(Math.random()*findAnimals.length)];
      const ins = document.getElementById('findAnimalInstruction');
      ins.innerHTML = `Tap the <span style="color:#ff4081; font-size:28px;">${targetAnimal.name.toUpperCase()}</span>! ${targetAnimal.emoji}`;
      document.getElementById('findAnimalMsg').textContent = '';
    }
    function chooseAnimal(name, el){
      if(!targetAnimal) return;
      if(name === targetAnimal.name){
        document.getElementById('findAnimalMsg').style.color = 'green';
        document.getElementById('findAnimalMsg').textContent = 'Great job! üéâ';
        correctSound.play();
        sendProgress({ inc_games: 1 });
        setTimeout(pickNewFindAnimal, 800);
      } else {
        document.getElementById('findAnimalMsg').style.color = 'red';
        document.getElementById('findAnimalMsg').textContent = 'Try again!';
        wrongSound.play();
        el.style.animation = 'shake 0.5s';
        setTimeout(()=> el.style.animation='', 500);
      }
    }

    function checkAnswers(){
      let score = 0;
      const correct = { q1:'Lion', q2:'Giraffe', q3:'Bird', q4:'Fish' };
      for (let q in correct){
        const opts = document.getElementsByName(q);
        for (let i=0;i<opts.length;i++){
          if (opts[i].checked && opts[i].value === correct[q]) score++;
        }
      }
      const badge = document.getElementById('badge');
      const text = document.getElementById('badge-text');
      const img  = document.getElementById('badge-img');
      const good = document.getElementById('correct-sound');
      const bad  = document.getElementById('wrong-sound');
      const BADGE = img.getAttribute('data-badge');
      const OOPS  = img.getAttribute('data-oops');
      if (score === 4) { text.innerText='üèÜ Gold Badge! Perfect Score!'; img.src = BADGE; good.play(); }
      else if (score === 3) { text.innerText='ü•à Silver Badge! Great Job!'; img.src = BADGE; good.play(); }
      else if (score === 2) { text.innerText='ü•â Bronze Badge! Keep Practicing!'; img.src = BADGE; good.play(); }
      else { text.innerText='‚ùå No Badge. Try Again!'; img.src = OOPS; bad.play(); }
      badge.style.display = 'block';
      sendProgress({ quiz_score: score });
    }
  </script>
</body>
</html>
